{% assign dom_id = page.id | append: 'navtree' %}
{% assign expanded = expanded_ids | contains: page.id %}
{%# assign active = selected_ids | contains: page.id %}
{% if params.depth %}
  {% assign depth = params.depth %}
{% else %}
  {% assign depth = 0 %}
{% endif %}
{% assign children_size = page.children_in_list | size %}

<li
  id="treeview-item__{{ dom_id }}"
  x-data="{ expanded: {{ !!expanded }} }"
  x-init="$watch('expanded', value => { document.getElementById('js-treeview__{{ dom_id }}')._x_dataStack[0].show = value; })"
  class="group page-tree--node"  
>
  <div class="flex space-x-1">
    <div style="width: calc(26px * {{ depth }})" class="flex-none justify-center"></div>

    <div class="flex-initial items-center max-w-80 px-1">
      {% if children_size > 0 %}
        <div @click="expanded = !expanded" class="flex items-center justify-center cursor-pointer">
    
  
          <!-- caret -->
          <span class="inline-block float-start me-1 mt-1 pt-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="transform transition duration-300" :class="{ 'rotate-90': expanded }" width=".8rem" height=".8rem" fill="currentColor" viewBox="0 0 512 512"><polyline points="184 112 328 256 184 400" style="fill:none;stroke:currentColor;stroke-linecap:round;stroke-linejoin:round;stroke-width:48px"/></svg>
          </span>

          <a
            href="{{ page.path }}"
            data-turbo-frame="main-content"
            data-turbo-action="advance"
            class="truncate"
            data-action="click->navtree#toggleActive"
            @click="header_navtree_show=false"
          >
            <span>{{ page.link_text | truncate: 160}}</span>
          </a>
        </div>
      {% else %}
        <a
          href="{{ page.path }}"
          data-turbo-frame="main-content"
          data-turbo-action="advance"
          class="truncate current hover:underline"
          data-action="click->navtree#toggleActive"
          @click="header_navtree_show=false"
        >
          <span>{{ page.link_text | truncate: 160 }}</span>
        </a>
      {% endif %}
    </div>
  </div>
  {% if children_size > 0 %}
    <template x-teleport="#js-treeview__{{ dom_id }}">
      {% assign selected_ids = selected_ids | join: ',' %}
      {% assign depth = depth | plus: 1 %}
      <turbo-frame
        id="frame-treeview__{{ dom_id }}"
        src="{{ site.nav_tree_path |  append: '?parent=' | append: page.id | append: '&selected_ids=' | append: selected_ids | append: '&depth=' | append: depth }}"
        loading="lazy"
        class="w-full float-none flex flex-col space-y-2 font-normal"
      >
      </turbo-frame>
    </template>
  {% endif %}
</li>
{% if children_size > 0 %}
  <ul
    id="js-treeview__{{ dom_id }}"
    class="relative"
    x-data="{ show: {{ !!expanded }} }"
    x-show="show"
    x-cloak
    x-collapse
  ></ul>
{% endif %}